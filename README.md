# AI 角色群聊

一款先进的 AI 聊天应用，用户可以在群聊环境中与多个可定制的 AI 角色进行互动。通过这款应用，您可以管理角色、精确地引导对话，并掌控话题的走向。

## 核心功能

### 👥 人设管理

- **创建、编辑和删除：** 轻松构建和管理一个自定义的 AI 角色库。
- **深度定制：** 为每个角色定义名称、头像（图标和颜色），以及详细的提示词，这些提示词决定了他们的性格、语气和知识库。
- **导入/导出：** 将您的整个角色库备份到一个 JSON 文件中，或与他人分享。您也可以导入现有的角色文件，以快速扩展您的角色阵容。

### 💬 动态群聊

- **多角色互动：** 与一组选定的活跃角色进行对话，创建一个模拟的群组讨论。
- **智能响应：** AI 会分析上下文，并从最合适的角色生成回应，使对话感觉自然且充满活力。

### 🗣️ 强大的对话控制

- **智能选择发言人：** 点击"让 AI 接话"按钮，系统将智能地选择最合适的角色来继续对话。
- **直接指定（@）：** 使用 `@` 符号（例如 `@贾行家`）来明确指定某个角色进行回答，让您能精确控制对话流程。
- **多角色同时提问（新功能）：** 可以在一条消息中 @ 多个角色（例如 `@贾行家 @万维钢 你们怎么看待这个问题？`），系统会并行生成多个角色的回答，让您能够同时听取不同角色的观点。
- **话题引导（#）：** 使用"话题方向"下拉菜单（或 `#` 快捷方式）来引导对话的重点。诸如"深入讲讲"、"通俗解释"或"批判思考"等选项会修改 AI 的指令，以符合您的目标。

### 🗂️ 便捷的会话管理

- **多会话支持：** 通过多个独立的会话来保持工作区的整洁，每个会话都有自己的上下文、参与者和设置。
- **完全控制：** 创建新聊天、为清晰起见重命名它们、将重要的聊天置顶以便快速访问，以及删除旧的聊天记录。
- **可折叠侧边栏：** 一个时尚、可折叠的侧边栏,让您可以在所有聊天之间轻松导航,而不会使界面变得混乱。
- **数据备份与恢复：** 支持导出所有会话数据到 JSON 文件进行备份,也可以从备份文件导入恢复数据。

### ⚙️ 高级定制

- **单会话设置：** 针对每个聊天，您可以通过以下方式微调体验：
  - 选择当前哪些角色处于活跃状态。
  - 启用“思考模式”以获得更深入、更全面的 AI 推理。
  - 调整“上下文窗口”以控制用于上下文的最近消息数量。
- **全局设置：** 自定义应用的外观（布局、字体、字号），设置您偏好的键盘快捷键，甚至修改驱动整个 AI 互动的基础系统提示词。

### 🧠 智能上下文记忆

- **长期上下文：** 应用通过完整发送最近的消息同时总结旧消息的方式，来智能地管理对话历史。这确保了 AI 在不超出 token 限制的情况下拥有长期上下文，从而实现连贯的、持久的讨论。

## 工作原理

本应用基于现代前端技术栈构建，并充分利用了 Google Gemini API 的强大功能。

- **前端：** 使用 **React** 和 **TypeScript** 构建，并采用 **Tailwind CSS** 进行样式设计，以实现响应式和现代化的用户界面。
- **AI 引擎：** 由 **Google Gemini API**（`gemini-2.5-flash` 模型）驱动，以实现快速、高质量的文本生成。
- **动态提示词工程：** 多角色模拟的魔力在于一个复杂的系统提示词，该提示词会在每次 API 调用时动态构建。它以编程方式组合了：
    1. 多角色协调的基础指令。
    2. 当前聊天中所有*活跃*角色的详细资料。
    3. 用户选择的“话题方向”。
    4. 一个精简和总结过的对话历史。
    5. 一个最终的、精确的指令，告诉 AI 应该由哪个角色发言（或者是否应由它自己选择）。
- **持久化存储：** 您所有的角色、对话和设置都保存在浏览器的 **Local Storage** 中，确保您的数据在会话之间得以保留，无需后端服务器。

## 项目结构

代码库的组织结构清晰，易于维护：

- **`components/`**: 包含构成应用 UI 的所有可重用 React 组件。
  - `ChatView.tsx`: 主聊天界面，包括消息、输入栏和对话控制。
  - `PersonaManagementView.tsx`: 用于创建、编辑和管理角色库的界面。
  - `Sidebar.tsx`: 用于导航和管理对话的左侧面板。
  - `Header.tsx`: 用于切换视图和访问设置的顶部导航栏。
  - `GlobalSettings.tsx` & `ConversationSettingsModal.tsx`: 用于应用级和聊天级设置的模态框。
- **`hooks/`**: 封装了应用的核心逻辑和状态管理。
  - `useConversations.ts`: 管理所有与对话相关的方面（增删改查、发送消息、状态）。
  - `usePersonas.ts`: 管理角色库。
  - `useAppSettings.ts`: 管理全局用户设置。
  - `useChatInput.ts`: 处理聊天输入的逻辑，包括 `@` 和 `#` 建议。
- **`services/`**: 处理外部通信和复杂的业务逻辑。
  - `aiService.ts`: 与 AI API 所有通信的接口。
  - `conversationManager.ts`: 管理与对话相关的任务，如总结和标题生成。
- **`types/`**: 包含应用数据结构的所有 TypeScript 类型定义。
- **`constants/`**: 存储应用范围内的常量，如默认角色和系统提示词。
- **`utils/`**: 存放小型的、可重用的工具函数。
  - `db.ts`: LocalStorage 数据管理模块，统一管理会话数据的存储、读取、导入和导出。
  - `shortcutFormatter.ts`: 快捷键格式化工具。
